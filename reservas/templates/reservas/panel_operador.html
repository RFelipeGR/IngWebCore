<h1>Panel del Operador - {{ cooperativa.nombre }}</h1>

<p style="text-align:right; margin-bottom:10px;">
    <a href="{% url 'operador_logout' %}" style="color:red; font-weight:bold;">
        Cerrar sesi√≥n ‚éã
    </a>
    <a href="{% url 'reactivar_pasajeros' %}" class="btn btn-warning mb-3">
    üîß Reactivar Pasajeros Transferidos
</a>

</p>

<table border="1" cellpadding="8">
    <thead>
        <tr>
            <th>Ruta</th>
            <th>Salida</th>
            <th>Bus</th>
            <th>Ocupaci√≥n</th>
            <th>Libres</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>

    <tbody>
        {% for h in data %}
        <tr>
            <td>{{ h.horario.ruta }}</td>
            <td>{{ h.horario.hora_salida }}</td>
            <td>{{ h.horario.bus.placa }}</td>

            <td>{{ h.ocupacion }}% ({{ h.usados }}/{{ h.total }})</td>
            <td>{{ h.libres }}</td>

            <td>
                {% if h.estado == 'CR√çTICO' %}
                    <span style="color:red;">CR√çTICO ‚úñ</span>
                {% else %}
                    <span style="color:green;">OK ‚úî</span>
                {% endif %}
            </td>

            <td>
                <a href="{% url 'detalle_reserva' h.horario.id %}">Ver</a> |
                <a href="{% url 'transferencias' h.horario.id %}">Transferencias</a> |
                <a href="{% url 'estadisticas_reserva' h.horario.id %}">Estad√≠sticas</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr>

<h2>Solicitudes de negociaci√≥n pendientes</h2>

{% if solicitudes %}
    {% for s in solicitudes %}
        <div style="border:2px solid #bbb; padding:15px; margin:15px 0; border-radius:8px;">

            <h3>üîÑ Solicitud de transferencia</h3>

            <p><strong>De la cooperativa:</strong> {{ s.obj.origen.bus.cooperativa.nombre }}</p>

            <p><strong>Ruta:</strong>
                {{ s.obj.origen.ruta.origen }} ‚Üí {{ s.obj.origen.ruta.destino }}
            </p>

            <p><strong>Bus origen:</strong>
                {{ s.obj.origen.bus.placa }} (Salida: {{ s.obj.origen.hora_salida }})
            </p>

            <p><strong>Bus destino:</strong>
                {{ s.obj.destino.bus.placa }} (Salida: {{ s.obj.destino.hora_salida }})
            </p>

            <hr>

            <p><strong>Pasajeros:</strong> {{ s.cantidad }}</p>
            <p><strong>Precio por pasajero:</strong> ${{ s.precio }}</p>

            <p><strong>Total ofrecido (origen):</strong> ${{ s.total_origen }}</p>
            <p><strong>Costo operativo destino:</strong> ${{ s.costo_operativo_destino }}</p>

            <p><strong>Ganancia destino:</strong> ${{ s.ganancia_destino }}</p>

            <p><strong>Gastos administrativos:</strong> ${{ s.gastos_admin }}</p>
            <p><strong>Comisi√≥n del sistema:</strong> ${{ s.comision_sistema }}</p>

            <p><strong>Margen de origen:</strong> ${{ s.margen_origen }}</p>
            <p><strong>Margen destino:</strong> ${{ s.margen_destino }}</p>

            <hr>

            <h3>üí∞ Resumen financiero r√°pido</h3>

            <p><strong>Ganancia cooperativa ORIGEN:</strong> ${{ s.margen_origen }}</p>

            <p><strong>Tu ganancia (DESTINO):</strong>
                <span style="font-weight:bold;
                    color:{% if s.ganancia_destino > 15 %}green{% elif s.ganancia_destino > 5 %}orange{% else %}red{% endif %};">
                    ${{ s.ganancia_destino }}
                </span>
            </p>

            <p><strong>Ganancia total del sistema:</strong> 
                ${{ s.margen_origen|add:s.ganancia_destino }}
            </p>

            {% if s.ganancia_destino > 15 %}
                <p style="color:green; font-weight:bold;">‚úî Conviene aceptar esta negociaci√≥n.</p>
            {% elif s.ganancia_destino > 5 %}
                <p style="color:orange; font-weight:bold;">‚ö† Es aceptable, revisa si tienes asientos disponibles.</p>
            {% else %}
                <p style="color:red; font-weight:bold;">‚úñ No conviene. La ganancia es baja.</p>
            {% endif %}

            <hr>

            <p><strong>Comentario:</strong> {{ s.obj.comentario_origen }}</p>

            <a href="{% url 'aceptar_negociacion' s.obj.id %}" style="color:green;font-weight:bold;">
                ‚úî Aceptar
            </a>
            |
            <a href="{% url 'rechazar_negociacion' s.obj.id %}" style="color:red;font-weight:bold;">
                ‚úñ Rechazar
            </a>

        </div>
    {% endfor %}
{% else %}
    <p>No hay solicitudes pendientes.</p>
{% endif %}
